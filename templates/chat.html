<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CLAIM-AI Chat</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif; margin: 0; background: #0b1220; color: #e7edf5; }
    .wrap { max-width: 900px; margin: 24px auto; padding: 0 16px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .card { background: #101827; border: 1px solid #22314b; border-radius: 10px; padding: 16px; }
    .msgs { height: 60vh; overflow: auto; border: 1px solid #22314b; border-radius: 8px; padding: 12px; background: #0e1525; }
    .m { margin: 8px 0; }
    .u { color: #9bcdff; }
    .a { color: #c4f0c2; }
    .row { display: flex; gap: 8px; margin-top: 12px; }
    input[type=text] { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #22314b; background: #0e1525; color: #e7edf5; }
    button { padding: 12px 16px; border-radius: 8px; border: 1px solid #29456d; background: #13243d; color: #d3e5ff; cursor: pointer; }
    button:disabled { opacity: .6; cursor: default; }
    a { color: #9bcdff; text-decoration: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>CLAIM-AI Chat</h1>
    <div class="card">
      <div id="msgs" class="msgs"></div>
      <div class="row">
        <input id="input" type="text" placeholder="Type a message… (e.g., /help or How do I run the pipeline?)" />
        <button id="send">Send</button>
      </div>
      <p style="margin-top:8px;">Tip: Ask things like “What does export_xactimate_csv output?” or “How do I fix XML parsing?”</p>
      <p><a href="http://127.0.0.1:5002/">Back to main UI</a></p>
    </div>
  </div>

  <script>
    const msgs = document.getElementById('msgs');
    const input = document.getElementById('input');
    const send  = document.getElementById('send');

    function add(role, text) {
      const d = document.createElement('div');
      d.className = 'm ' + (role === 'user' ? 'u' : 'a');
      d.textContent = (role === 'user' ? 'You: ' : 'Bot: ') + text;
      msgs.appendChild(d);
      msgs.scrollTop = msgs.scrollHeight;
    }

    async function submit() {
      const txt = input.value.trim();
      if (!txt) return;
      input.value = '';
      add('user', txt);
      send.disabled = true;
      try {
        const r = await fetch('/api/chat', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({message: txt})
        });
        const j = await r.json();
        add('assistant', j.reply || '(no reply)');
      } catch (e) {
        add('assistant', 'Error: ' + e);
      } finally {
        send.disabled = false;
        input.focus();
      }
    }

    send.addEventListener('click', submit);
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') submit();
    });

    // Greeting
    add('assistant', 'Hi! I’m the CLAIM-AI chat. Ask me about the pipeline or project.');
  </script>
</body>
</html>
